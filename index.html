<!DOCTYPE html>
<html lang="fr">
<head>
</head>
<body>
    <header>
        <h1>LeagueOfWinn</h1>
    </header>

    <main>
        <h2>RÃ´le :</h2>
        <select id="role">
            <option value="Top">Top</option>
            <option value="Jungle">Jungle</option>
            <option value="Mid">Mid</option>
            <option selected value="ADC">Adc</option>
            <option value="Support">Supp</option>
        </select>

        <h3>Champions favoris:</h3>
        <select id="fav1"></select>
        <select id="fav2"></select>
        <select id="fav3"></select>

        <br /><br /><br /><br />

        <table>
            <tr>
                <th><div><img id="a1-img" class="champback" src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Aatrox_0.jpg"/><select class="champselect allie" id="a1"></select></div></th>
                <th><div><img id="a2-img" class="champback" src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Aatrox_0.jpg"/><select class="champselect allie" id="a2"></select></div></th>
                <th><div><img id="a3-img" class="champback" src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Aatrox_0.jpg"/><select class="champselect allie" id="a3"></select></div></th>
                <th><div><img id="a4-img" class="champback" src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Aatrox_0.jpg"/><select class="champselect allie" id="a4"></select></div></th>
                <th style="display: block;"><div style="position: absolute;" class="res"></div></th>
                <th><div><img id="e1-img" class="champback" src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Aatrox_0.jpg"/><select class="champselect ennemie" id="e1"></select></div></th>
                <th><div><img id="e2-img" class="champback" src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Aatrox_0.jpg"/><select class="champselect ennemie" id="e2"></select></div></th>
                <th><div><img id="e3-img" class="champback" src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Aatrox_0.jpg"/><select class="champselect ennemie" id="e3"></select></div></th>
                <th><div><img id="e4-img" class="champback" src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Aatrox_0.jpg"/><select class="champselect ennemie" id="e4"></select></div></th>
                <th><div><img id="e5-img" class="champback" src="https://ddragon.leagueoflegends.com/cdn/img/champion/loading/Aatrox_0.jpg"/><select class="champselect ennemie" id="e5"></select></div></th>
            </tr>
        </table>
    </main>

</body>
</html>

<script src="./avec.js"></script>
<script src="./contre.js"></script>
<script src="./champ.js"></script>
<script>
    function createOptionsChamps(defaultSelected) {
        let options = []
        for (let i = 0; i < champ.length; i++) {
            let option = document.createElement('option')
            option.value = champ[i].name
            option.innerText = champ[i].name

            if (defaultSelected == champ[i].name)
                option.selected = true
            
            options.push(option)
        }

        if (defaultSelected == "Default") {
            let option = document.createElement('option')
            option.value = "Default"
            option.innerText = "-"
            option.selected = true
            options.push(option)
        }

        return options
    }

    function appendsOptionsToId(id, options) {
        let element = document.querySelector(`#${id}`)
        for (let i = 0; i < options.length; i++)
            element.appendChild(options[i])
    }

    appendsOptionsToId('fav1', createOptionsChamps("Jhin"))
    appendsOptionsToId('fav2', createOptionsChamps("Kai'Sa"))
    appendsOptionsToId('fav3', createOptionsChamps("Jinx"))

    //appendsOptionsToId('a1', createOptionsChamps("Garen"))
    //appendsOptionsToId('a2', createOptionsChamps("Shaco"))
    //appendsOptionsToId('a3', createOptionsChamps("Viktor"))
    //appendsOptionsToId('a4', createOptionsChamps("Soraka"))
    //appendsOptionsToId('e1', createOptionsChamps("Sion"))
    //appendsOptionsToId('e2', createOptionsChamps("Hecarim"))
    //appendsOptionsToId('e3', createOptionsChamps("Veigar"))
    //appendsOptionsToId('e4', createOptionsChamps("Samira"))
    //appendsOptionsToId('e5', createOptionsChamps("Yuumi"))
    appendsOptionsToId('a1', createOptionsChamps("Default"))
    appendsOptionsToId('a2', createOptionsChamps("Default"))
    appendsOptionsToId('a3', createOptionsChamps("Default"))
    appendsOptionsToId('a4', createOptionsChamps("Default"))
    appendsOptionsToId('e1', createOptionsChamps("Default"))
    appendsOptionsToId('e2', createOptionsChamps("Default"))
    appendsOptionsToId('e3', createOptionsChamps("Default"))
    appendsOptionsToId('e4', createOptionsChamps("Default"))
    appendsOptionsToId('e5', createOptionsChamps("Default"))

    let champselects = document.getElementsByClassName("champselect")
    for (let i = 0; i < champselects.length; i++) {
        champselects[i].addEventListener('change', () => {modifyOption(champselects[i], i)})
    }

    function modifyOption(element, i) {
        let img = document.querySelector(`#${element.id}-img`)
        img.src = `https://ddragon.leagueoflegends.com/cdn/img/champion/loading/${element.value}_0.jpg`
        myFunction()
    }






    function myFunction() {
        let classAllies   = document.querySelectorAll('.allie')
        let classEnnemies = document.querySelectorAll('.ennemie')
    
        let allies   = []
        let ennemies = []

        for (let i = 0; i < classAllies.length; i++)
            allies.push(classAllies[i].value)
        for (let i = 0; i < classEnnemies.length; i++)
            ennemies.push(classEnnemies[i].value)




        let role = document.querySelector('#role').value
        
        let champInRole = []

        for (let i = 0; i < champ.length; i++)
            if (champ[i].role == role)
                champInRole.push(champ[i].name)


        let stats = []
        for (let i = 0; i < champInRole.length; i++)
            stats.push([])

        for (let i = 0; i < champInRole.length; i++) {
            let currChamp = {}
            for (const [key, value] of Object.entries(avec)) {
                if (value.Avec == champInRole[i])
                    currChamp = value
            }

            for (const [key, value] of Object.entries(currChamp)) {
                for (let j = 0; j < allies.length; j++) {
                    if (key == allies[j]) {
                        if (typeof(value) == "number")
                            stats[i].push(value)
                        if (typeof(value) == "string")
                            stats[i].push(parseFloat(value.replace(",",".")))
                    }
                }
            }

            currChamp = {}
            for (const [key, value] of Object.entries(contre)) {
                if (value.Contre == champInRole[i])
                    currChamp = value
            }

            for (const [key, value] of Object.entries(currChamp)) {
                for (let j = 0; j < ennemies.length; j++) {
                    if (key == ennemies[j]) {
                        if (typeof(value) == "number")
                            stats[i].push(value)
                        if (typeof(value) == "string")
                            stats[i].push(parseFloat(value.replace(",",".")))
                    }
                }
            }
        }


        let finale = []
        for (let i = 0; i < champInRole.length; i++) {
            const sum = stats[i].reduce((acc, val) => acc + val, 0);
            const avg = sum / stats[i].length;
            finale.push({name: champInRole[i], average: avg})
        }
        finale.sort(function(a, b) {return b.average - a.average})


        let favChamp = []
        favChamp.push(document.querySelector('#fav1').value)
        favChamp.push(document.querySelector('#fav2').value)
        favChamp.push(document.querySelector('#fav3').value)

        document.querySelector('.res').innerHTML = ""
        for (let i = 0; i < finale.length; i++) {
            if (!isNaN(finale[i].average)) {
                let div = document.createElement('div')
                let img = document.createElement('img')

                div.style.display = "flex"
                div.style.alignItems = "center"
                div.style.justifyContent = "center"

                img.src = `https://ddragon.leagueoflegends.com/cdn/13.7.1/img/champion/${finale[i].name}.png`
                img.style.width = "20%"

                
                for (let j = 0; j < favChamp.length; j++)
                    if (favChamp[j] == finale[i].name)
                        div.style.backgroundColor = "yellow"

                div.append(img)
                div.append(`${finale[i].average.toFixed(2)}%`)

                document.querySelector('.res').append(div)
            } else {
                console.log(finale[i])
            }
        }
    }




</script>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
}

header {
    background-color: #1a1a1a;
    padding: 20px;
    text-align: center;
}

h1 {
    color: #ffffff;
    font-size: 2rem;
}

main {
    padding: 20px;
}

input[type="text"] {
    width: 100%;
    padding: 5px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th {
  width: 10%;
  overflow: hidden;
}

.champback {
  width: 100%;
}

</style>
